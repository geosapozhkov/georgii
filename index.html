<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>georgii</title>
    <link rel="preload" href="BookletSans-regular.woff" as="font" type="font/woff" crossorigin>
    <!-- Preload critical images for faster loading -->
    <link rel="preload" href="https://raw.githubusercontent.com/geosapozhkov/georgii/main/texts/0.png" as="image">
    <link rel="preload" href="https://raw.githubusercontent.com/geosapozhkov/georgii/main/texts/1.png" as="image">
    <link rel="preload" href="https://raw.githubusercontent.com/geosapozhkov/georgii/main/texts/2.png" as="image">
    <style>
        @font-face {
            font-family: 'BookletSans';
            src: url('BookletSans-regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'BookletSans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #ffffff;
            color: #3C3C3C;
            line-height: 1.6;
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            padding: 0;
            margin: 0;
        }

        /* Debug grid - visible only in dev tools */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: 
                /* Left margin line (17px) */
                linear-gradient(to right, transparent 0px, transparent calc(17px - 1px), rgba(255, 0, 0, 0.5) calc(17px - 1px), rgba(255, 0, 0, 0.5) 17px, transparent 17px),
                /* Right margin line (17px from right) */
                linear-gradient(to right, transparent 0px, transparent calc(100vw - 17px - 1px), rgba(255, 0, 0, 0.5) calc(100vw - 17px - 1px), rgba(255, 0, 0, 0.5) calc(100vw - 17px), transparent calc(100vw - 17px)),
                /* Horizontal lines */
                linear-gradient(to bottom, transparent 0px, transparent calc(13px - 1px), rgba(255, 0, 0, 0.5) calc(13px - 1px), rgba(255, 0, 0, 0.5) 13px, transparent 13px),
                linear-gradient(to bottom, transparent 0px, transparent calc(100px - 1px), rgba(255, 0, 0, 0.5) calc(100px - 1px), rgba(255, 0, 0, 0.5) 100px, transparent 100px),
                linear-gradient(to bottom, transparent 0px, transparent calc(100vh - 10px - 1px), rgba(255, 0, 0, 0.5) calc(100vh - 10px - 1px), rgba(255, 0, 0, 0.5) calc(100vh - 10px), transparent calc(100vh - 10px));
            background-size: 100vw 100vh;
            pointer-events: none;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Show grid when body has debug class */
        body.debug::before {
            opacity: 1;
        }


        /* Header Grid System */
        .header-grid {
            position: fixed;
            top: 10px;
            left: 17px;
            right: 17px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            z-index: 1004;
            align-items: flex-start;
            height: 72px; /* Fixed height to match logo */
        }

        /* Logo in grid */
        .logo {
            grid-column: 1 / 4; /* Spans 3 columns */
            font-size: 72px;
            font-weight: bold;
            color: #3C3C3C;
            text-decoration: none;
            cursor: pointer;
            transition: opacity 0.2s ease;
            line-height: 1;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .logo:hover {
            opacity: 0.7;
        }

        /* Navigation in header content */
        .navigation {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            flex-shrink: 0;
            align-self: flex-start;
            margin-top: -3px; /* Move navigation 3px closer to top edge */
        }

        /* Description and Navigation container */
        .header-content {
            grid-column: 6 / 13; /* Spans 7 columns from column 6 to edge */
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 40px;
            height: 72px; /* Fixed height to prevent vertical movement */
            overflow: hidden; /* Hide any overflow */
        }

        /* Description in header grid */
        .header-description {
            flex: 1;
            font-size: 15px;
            line-height: 1.2;
            color: #3C3C3C;
            padding: 0;
            margin: 0;
            align-self: flex-start;
            height: 72px; /* Fixed height to ensure consistent alignment */
            display: flex;
            align-items: flex-start;
            overflow: hidden; /* Hide any overflow text */
        }

        .nav-link {
            text-decoration: none;
            color: #3C3C3C;
            font-size: 15px;
            font-weight: normal;
            transition: color 0.2s ease;
            line-height: 1.6;
        }

        .nav-link:hover {
            color: #666666;
        }

        .nav-link.active {
            color: #3C3C3C;
            opacity: 0.5;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            padding: 0 17px 0 20px;
            gap: 60px;
        }

        /* Left Content - Catalog grid */
        .content-left { flex: 0 0 auto; padding-left: 17px; margin-top: 170px; }

        .catalog-grid {
            display: grid;
            grid-template-columns: auto auto auto;
            column-gap: 120px;
            row-gap: 16px;
            align-content: start;
            padding-top: 10px;
            width: fit-content;
        }

        .col-header { font-size: 15px; }
        .cell { height: 32px; display: flex; align-items: center; }
        .catalog-link { font-size: 48px; color: #3C3C3C; text-decoration: none; display: inline-block; transition: opacity 200ms ease; line-height: 1; }
        .catalog-empty { font-size: 48px; color: #3C3C3C; line-height: 1; }
        .catalog-client { font-size: 48px; color: #3C3C3C; line-height: 1; }
        .catalog-year { font-size: 48px; color: #3C3C3C; line-height: 1; }
        .catalog-link.dimmed { opacity: 0.25; }
        .catalog-placeholder { opacity: 0.25; pointer-events: none; cursor: default; }

        /* Lots of Letters Gallery */
        .letters-gallery {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            padding: 0;
            margin: 0;
        }

        #texts-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
        }

        /* Draggable text styles */
        .draggable-text {
            cursor: pointer;
            border-radius: 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .draggable-text.lifted {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            cursor: grab;
        }

        .draggable-text.lifted:active {
            cursor: grabbing;
        }

        /* Modal for full-size image viewing */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
        }

        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .image-modal.active {
            display: flex;
        }

        /* Video modal styles */
        .image-modal video {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }


        .text-content {
            font-size: 15px;
            line-height: 1.2;
            color: #3C3C3C;
            transition: opacity 200ms ease;
            padding: 0;
            margin: 0;
            width: 100%;
            height: 72px; /* Match the parent container height */
            overflow: hidden; /* Hide any overflow text */
            display: flex;
            align-items: flex-start;
        }

        .text-content p {
            margin-bottom: 0;
        }

        .text-content p:last-child {
            margin-bottom: 0;
        }

        /* Catalogs */
        .catalogs {
            display: flex;
            gap: 120px;
            padding: 40px 0 0 20px;
        }

        .catalog-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .catalog-label {
            font-size: 15px;
        }

        .catalog-title {
            font-size: 48px;
            color: #3C3C3C;
        }

        /* Hover preview canvas */
        #previewCanvas {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            display: none;
            z-index: 1007;
        }

        /* 12-column grid system for project galleries */
        .project-gallery {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            width: calc(100vw - 40px);
            margin: 20px;
            padding: 0;
            max-width: none;
        }

        /* Column span classes for project galleries - minimum 4 columns */
        .gallery-col-1 { grid-column: span 4; } /* Minimum size */
        .gallery-col-2 { grid-column: span 4; } /* Minimum size */
        .gallery-col-3 { grid-column: span 4; } /* Minimum size */
        .gallery-col-4 { grid-column: span 4; }
        .gallery-col-5 { grid-column: span 5; }
        .gallery-col-6 { grid-column: span 6; }
        .gallery-col-7 { grid-column: span 7; }
        .gallery-col-8 { grid-column: span 8; }
        .gallery-col-9 { grid-column: span 9; }
        .gallery-col-10 { grid-column: span 10; }
        .gallery-col-11 { grid-column: span 11; }
        .gallery-col-12 { grid-column: span 12; }

        /* Column start classes for project galleries */
        .gallery-start-1 { grid-column-start: 1; }
        .gallery-start-2 { grid-column-start: 2; }
        .gallery-start-3 { grid-column-start: 3; }
        .gallery-start-4 { grid-column-start: 4; }
        .gallery-start-5 { grid-column-start: 5; }
        .gallery-start-6 { grid-column-start: 6; }
        .gallery-start-7 { grid-column-start: 7; }
        .gallery-start-8 { grid-column-start: 8; }
        .gallery-start-9 { grid-column-start: 9; }
        .gallery-start-10 { grid-column-start: 10; }
        .gallery-start-11 { grid-column-start: 11; }
        .gallery-start-12 { grid-column-start: 12; }

        /* Responsive adjustments for project galleries */
        @media (max-width: 768px) {
            .project-gallery {
                grid-template-columns: repeat(6, 1fr);
                gap: 15px;
                width: calc(100vw - 30px);
                margin: 15px;
                padding: 0;
            }
            
            /* Minimum 3 columns on tablets */
            .gallery-col-1, .gallery-col-2, .gallery-col-3 { grid-column: span 3; }
        }

        @media (max-width: 480px) {
            .project-gallery {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                width: calc(100vw - 20px);
                margin: 10px;
                padding: 0;
            }
            
            /* Minimum 2 columns on mobile */
            .gallery-col-1, .gallery-col-2, .gallery-col-3 { grid-column: span 2; }
        }

        /* Footer Grid System */
        .footer-grid {
            position: fixed;
            bottom: 10px;
            left: 17px;
            right: 17px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            z-index: 1002;
            align-items: end;
        }

        .footer-content {
            grid-column: 1 / 4; /* Spans 3 columns */
            font-size: 15px;
            color: #3C3C3C;
            line-height: 1;
        }

        .footer div {
            margin: 0;
            line-height: 1;
        }

        .footer div:first-child {
            margin-bottom: 1px;
        }


        /* Responsive design for different screen sizes */
        @media (max-width: 1024px) {
            .header-grid {
                gap: 15px;
            }
            
            .logo {
                grid-column: 1 / 4; /* Reduce logo area */
                font-size: 60px;
            }
            
            .header-content {
                grid-column: 4 / 13; /* Adjust content area */
                gap: 30px;
            }
            
            .footer-grid {
                gap: 15px;
            }
            
            .footer-content {
                grid-column: 1 / 6; /* Expand footer area */
            }
        }

        @media (max-width: 768px) {
            .header-grid {
                gap: 10px;
            }
            
            .logo {
                grid-column: 1 / 6; /* Reduce logo area */
                font-size: 48px;
            }
            
            .header-content {
                grid-column: 6 / 13; /* Expand content area */
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-description {
                font-size: 14px;
            }
            
            .navigation {
                gap: 20px;
            }
            
            .nav-link {
                font-size: 14px;
            }
            
            .footer-grid {
                gap: 10px;
            }
            
            .footer-content {
                grid-column: 1 / 8; /* Expand footer area */
            }
        }

        @media (max-width: 480px) {
            .header-grid {
                grid-template-columns: 1fr; /* Single column layout */
                gap: 15px;
            }
            
            .logo {
                grid-column: 1;
                font-size: 40px;
                text-align: center;
            }
            
            .header-content {
                grid-column: 1;
                align-items: center;
                text-align: center;
            }
            
            .header-description {
                font-size: 13px;
            }
            
            .navigation {
                justify-content: center;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .footer-grid {
                grid-template-columns: 1fr; /* Single column layout */
                gap: 10px;
            }
            
            .footer-content {
                grid-column: 1;
                text-align: center;
            }
        }

        .catalog-placeholder {
            opacity: 0.15;
            pointer-events: none;
            cursor: default;
            font-size: 48px;
            line-height: 1;
        }

        /* Custom cursor */
        * {
            cursor: none !important;
        }

        .custom-cursor {
            position: fixed;
            width: 8px;
            height: 8px;
            background-color: #4D4D4D;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
            transform: translate(-50%, -50%);
        }

        .custom-cursor:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }

        /* Drawing canvas */
        #drawingCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: auto;
            z-index: 1005;
            cursor: none;
        }

        /* Drawing cursor */
        .drawing-cursor {
            position: fixed;
            background-color: #000000;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1006;
            transition: transform 0.1s ease;
            transform: translate(-50%, -50%);
            display: none;
        }

        .drawing-cursor.eraser {
            background-color: #ffffff;
            border: 2px solid #000000;
        }
    </style>
</head>
<body>
    <div class="custom-cursor" id="customCursor"></div>
    <canvas id="drawingCanvas"></canvas>
    <div class="drawing-cursor" id="drawingCursor"></div>
    <div class="header-grid">
        <a href="#" class="logo" id="logo">Georgii</a>
        <div class="header-content">
            <div class="header-description">
                <div class="text-content">
                    <p>Life and design explorer, pictures with meaning and quality creator.<br>I'm interested in contributing to the visual image of modernity, while exploring and reflecting on the visual culture of our world. I'm open to working with studios, designers, and anyone passionate about creating images that tell their own story.</p>
                </div>
            </div>
            <nav class="navigation">
                <a href="#" class="nav-link">Lots of Letters</a>
                <a href="#" class="nav-link">Mind</a>
                <a href="#" class="nav-link">Commerce</a>
                <a href="#" class="nav-link">About me</a>
            </nav>
        </div>
    </div>
    <section class="content-left" style="display: none;">
        <!-- Content will be dynamically loaded here -->
    </section>

    <!-- Lots of Letters Gallery -->
    <section class="letters-gallery" id="letters-gallery" style="display: none;">
        <canvas id="texts-canvas"></canvas>
    </section>

    <main class="main-content">
        <!-- Description moved to header-grid -->
    </main>
    <canvas id="previewCanvas"></canvas>
    
    <!-- Image/Video Modal -->
    <div class="image-modal" id="imageModal">
        <img id="modalImage" src="" alt="" style="display: none;">
        <video id="modalVideo" controls muted style="display: none;">
            <source src="" type="video/mp4">
        </video>
    </div>
    
    <footer class="footer-grid">
        <div class="footer-content">
            <div>sapozhkov.george@gmail.com</div>
            <div>@georgiisapozhkov</div>
        </div>
    </footer>
    
</body>
<script>
    (function(){
        const canvas = document.getElementById('previewCanvas');
        const ctx = canvas.getContext('2d');
        let animationId = null;
        let rects = [];
        let active = false;
        let activePreviewId = null; // disable hover preview for active catalog

        function resize(){
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        function createRects(seed){
            const rnd = (min, max) => Math.random() * (max - min) + min;
            rects = [];
            
            for(let i = 0; i < 3; i++) {
                let attempts = 0;
                let rect;
                
                do {
                    // Random size with good aspect ratio
                    const aspectRatios = [4/3, 3/2, 16/9, 5/4];
                    const randomAspect = aspectRatios[Math.floor(Math.random() * aspectRatios.length)];
                    
                    const w = rnd(300, 600);
                    const h = Math.round(w / randomAspect);
                    
                    rect = {
                        x: rnd(0, window.innerWidth - w),
                        y: rnd(0, window.innerHeight - h),
                        w: w,
                        h: h,
                vx: rnd(-0.7, 0.7) || 0.5,
                vy: rnd(-0.7, 0.7) || -0.4,
                    };
                    
                    attempts++;
                } while (attempts < 50 && rects.some(existing => 
                    rect.x < existing.x + existing.w && 
                    rect.x + rect.w > existing.x && 
                    rect.y < existing.y + existing.h && 
                    rect.y + rect.h > existing.y
                ));
                
                rects.push(rect);
            }
        }

        // Function to create project preview images
        function createProjectRects(previewId){
            const rnd = (min, max) => Math.random() * (max - min) + min;
            
            if (previewId === 'angry-masseur') {
                // Create animated video previews
                const videoFiles = [
                    'Zloy 011 (1080p with 30fps).mp4',
                    'Igor.mp4',
                    'Hood_two_screens.mp4'
                ];
                
                // Clear existing preview videos
                document.querySelectorAll('.preview-video').forEach(video => video.remove());
                
                rects = new Array(3).fill(0).map((_, i) => {
                    const videoFile = videoFiles[i];
                    
                    // Create actual video element for preview
                    const video = document.createElement('video');
                    video.src = `https://raw.githubusercontent.com/geosapozhkov/georgii/main/commerce/poool/AngryM/${videoFile}`;
                    video.className = 'preview-video';
                    video.muted = true;
                    video.loop = true;
                    video.autoplay = true;
                    video.preload = 'auto';
                    video.playsInline = true;
                    video.style.position = 'fixed';
                    video.style.zIndex = '1007';
                    video.style.pointerEvents = 'none';
                    video.style.border = 'none';
                    video.style.borderRadius = '0';
                    video.style.objectFit = 'contain';
                    
                    // Add event listeners to ensure video plays
                    video.addEventListener('loadeddata', () => {
                        video.play().catch(e => console.log('Video autoplay prevented:', e));
                    });
                    
                    video.addEventListener('canplay', () => {
                        video.play().catch(e => console.log('Video autoplay prevented:', e));
                    });
                    
                    // Try to play immediately
                    setTimeout(() => {
                        video.play().catch(e => console.log('Video autoplay prevented:', e));
                    }, 100);
                    
                    // Random width, let video determine its own height based on original proportions
                    const w = rnd(300, 600);
                    const h = 'auto'; // Let video maintain its original aspect ratio
                    
                    const x = rnd(0, window.innerWidth - w);
                    const y = rnd(0, window.innerHeight - 400); // Use max expected height
                    
                    video.style.width = w + 'px';
                    video.style.height = h;
                    video.style.left = x + 'px';
                    video.style.top = y + 'px';
                    
                    document.body.appendChild(video);
                    
                    return {
                        x: x,
                        y: y,
                        w: w,
                        h: 400, // Use estimated height for collision detection
                        vx: rnd(-0.5, 0.5) || 0.3,
                        vy: rnd(-0.5, 0.5) || -0.2,
                        videoElement: video,
                        type: 'video'
                    };
                });
            } else {
                // Default rectangles for other previews
                createRects();
            }
        }

        function resolveRectCollision(a, b){
            const ax2 = a.x + a.w, ay2 = a.y + a.h;
            const bx2 = b.x + b.w, by2 = b.y + b.h;
            const overlapX = Math.min(ax2 - b.x, bx2 - a.x);
            const overlapY = Math.min(ay2 - b.y, by2 - a.y);
            
            // Only resolve collision if there's actual overlap
            if (overlapX > 0 && overlapY > 0) {
                // Force separation to prevent any overlap
            if (overlapX < overlapY){
                    // separate on X axis
                    const push = overlapX / 2 + 1; // Add 1px to ensure complete separation
                    if (a.x < b.x){ 
                        a.x -= push; 
                        b.x += push; 
            } else {
                        a.x += push; 
                        b.x -= push; 
                    }
                    a.vx *= -1; 
                    b.vx *= -1;
                } else {
                    // separate on Y axis
                    const push = overlapY / 2 + 1; // Add 1px to ensure complete separation
                    if (a.y < b.y){ 
                        a.y -= push; 
                        b.y += push; 
                    } else { 
                        a.y += push; 
                        b.y -= push; 
                    }
                    a.vy *= -1; 
                    b.vy *= -1;
                }
                
                // Update video element positions if they exist
                if (a.type === 'video' && a.videoElement) {
                    a.videoElement.style.left = a.x + 'px';
                    a.videoElement.style.top = a.y + 'px';
                }
                if (b.type === 'video' && b.videoElement) {
                    b.videoElement.style.left = b.x + 'px';
                    b.videoElement.style.top = b.y + 'px';
                }
            }
        }

        function step(){
            ctx.clearRect(0,0,canvas.width,canvas.height);
            // integrate
            for(const r of rects){
                r.x += r.vx; r.y += r.vy;
                if (r.x <= 0 || r.x + r.w >= window.innerWidth) { r.vx *= -1; r.x = Math.max(0, Math.min(window.innerWidth - r.w, r.x)); }
                if (r.y <= 0 || r.y + r.h >= window.innerHeight) { r.vy *= -1; r.y = Math.max(0, Math.min(window.innerHeight - r.h, r.y)); }
                
                // Update video element position if it exists
                if (r.type === 'video' && r.videoElement) {
                    r.videoElement.style.left = r.x + 'px';
                    r.videoElement.style.top = r.y + 'px';
                }
                
                // Update image element position if it exists
                if (r.image) {
                    r.image.style.left = r.x + 'px';
                    r.image.style.top = r.y + 'px';
                }
            }
            // pairwise collisions
            for(let i=0;i<rects.length;i++){
                for(let j=i+1;j<rects.length;j++){
                    const a = rects[i], b = rects[j];
                    if (a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y){
                        resolveRectCollision(a,b);
                    }
                }
            }
            // draw
            ctx.fillStyle = '#D9D9D9';
            for(const r of rects){
                if (r.type === 'video') {
                    // Don't draw anything on canvas for videos - they are real video elements
                } else if (r.image) {
                    // Don't draw anything on canvas for images - they are real image elements
                } else if (r.isPlaceholder) {
                    // Draw gray placeholder rectangle
                    ctx.fillRect(r.x, r.y, r.w, r.h);
                } else {
                    // Draw default rectangle
                ctx.fillRect(r.x, r.y, r.w, r.h);
                }
            }
            animationId = requestAnimationFrame(step);
        }

        // Function to force separation of all overlapping elements
        function forceSeparation() {
            for(let i = 0; i < rects.length; i++) {
                for(let j = i + 1; j < rects.length; j++) {
                    const a = rects[i], b = rects[j];
                    const ax2 = a.x + a.w, ay2 = a.y + a.h;
                    const bx2 = b.x + b.w, by2 = b.y + b.h;
                    const overlapX = Math.min(ax2 - b.x, bx2 - a.x);
                    const overlapY = Math.min(ay2 - b.y, by2 - a.y);
                    
                    // Force separation if there's any overlap
                    if (overlapX > 0 && overlapY > 0) {
                        if (overlapX < overlapY) {
                            // separate on X axis
                            const push = overlapX / 2 + 5; // Extra separation
                            if (a.x < b.x) {
                                a.x -= push;
                                b.x += push;
                            } else {
                                a.x += push;
                                b.x -= push;
                            }
                        } else {
                            // separate on Y axis
                            const push = overlapY / 2 + 5; // Extra separation
                            if (a.y < b.y) {
                                a.y -= push;
                                b.y += push;
                            } else {
                                a.y += push;
                                b.y -= push;
                            }
                        }
                        
                        // Update video element positions if they exist
                        if (a.type === 'video' && a.videoElement) {
                            a.videoElement.style.left = a.x + 'px';
                            a.videoElement.style.top = a.y + 'px';
                        }
                        if (b.type === 'video' && b.videoElement) {
                            b.videoElement.style.left = b.x + 'px';
                            b.videoElement.style.top = b.y + 'px';
                        }
                    }
                }
            }
        }

        function start(previewId){
            // do not show animated preview for the active catalog (only for Mind tab)
            const currentTab = localStorage.getItem('activeTab') || 'Mind';
            if (currentTab !== 'Commerce' && activePreviewId && String(previewId) === String(activePreviewId)) return;
            if (active) return;
            active = true;
            canvas.style.display = 'block';
            createProjectRects(previewId);
            
            // Force separation immediately after creation to prevent initial overlaps
            forceSeparation();
            
            cancelAnimationFrame(animationId);
            animationId = requestAnimationFrame(step);
        }
        function stop(){
            active = false;
            canvas.style.display = 'none';
            cancelAnimationFrame(animationId);
            
            // Remove all preview video elements
            const previewVideos = document.querySelectorAll('.preview-video');
            previewVideos.forEach(video => video.remove());
            
            // Remove all preview images
            document.querySelectorAll('img[style*="position: fixed"]').forEach(img => {
                if (img.style.zIndex === '1007' && img.style.pointerEvents === 'none') {
                    img.remove();
                }
            });
            
            // Clear rects array
            rects = [];
            
            // Reset activePreviewId when stopping
            activePreviewId = null;
        }

        // Event listeners are now attached dynamically when switching tabs

        // Navigation and Gallery functionality
        const navLinks = document.querySelectorAll('.nav-link');
        const mainContent = document.querySelector('.content-left');
        const lettersGallery = document.getElementById('letters-gallery');
        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');


        // Image cache for better performance
        const imageCache = new Map();
        
        // Load draggable text images with optimization
        function loadDraggableTextImages() {
            // Clear existing draggable images first
            const existingImages = document.querySelectorAll('.draggable-text');
            existingImages.forEach(img => img.remove());
            
            // List of all .png files in the texts folder
            const imageNames = [
                '0.png','1.png','2.png','3.png','4.png','5.png','6.png','7.png','8.png','9.png',
                '10.png','11.png','12.png','13.png','14.png','15.png','16.png','17.png','18.png','19.png',
                '20.png','21.png','22.png','23.png','24.png','25.png','26.png','27.png','28.png','29.png',
                '30.png','31.png','32.png','33.png','34.png','35.png','36.png','37.png','38.png','39.png',
                '40.png','41.png','42.png','43.png'
            ];
            
            const screenW = window.innerWidth;
            const screenH = window.innerHeight;
            
            // Load images in batches for better performance
            const batchSize = 5;
            let currentBatch = 0;
            
            function loadBatch() {
                const startIndex = currentBatch * batchSize;
                const endIndex = Math.min(startIndex + batchSize, imageNames.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const name = imageNames[i];
                const img = document.createElement('img');
                    
                    // Check cache first
                    if (imageCache.has(name)) {
                        img.src = imageCache.get(name);
                    } else {
                img.src = `https://raw.githubusercontent.com/geosapozhkov/georgii/main/texts/${name}`;
                        // Cache the image
                        img.onload = () => imageCache.set(name, img.src);
                    }
                    
                img.className = 'draggable-text';
                img.alt = `Text ${name}`;
                    img.loading = 'lazy'; // Lazy loading for better performance
                img.style.position = 'fixed';
                img.style.width = 'auto';
                img.style.height = 'auto';
                img.style.maxWidth = '441px'; // 294px * 1.5 ≈ 441px
                img.style.zIndex = '100';
                
                // Random position within the screen
                const left = Math.floor(Math.random() * (screenW - 400));
                const top = Math.floor(Math.random() * (screenH - 300));
                img.style.left = left + 'px';
                img.style.top = top + 'px';
                
                document.body.appendChild(img);
                }
                
                currentBatch++;
                
                // Load next batch after a short delay
                if (endIndex < imageNames.length) {
                    setTimeout(loadBatch, 100);
                } else {
            console.log('Loaded', imageNames.length, 'images to body');
                }
            }
            
            loadBatch();
        }

        // Drag and drop for .draggable-text images (single click to lift, drag, and lay down)
        (function() {
            let dragImg = null;
            let offsetX = 0;
            let offsetY = 0;
            let zCounter = 100;
            let isDragging = false;
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('draggable-text')) {
                    if (!dragImg) {
                        // Start dragging - lift the image
                        dragImg = e.target;
                        const rect = dragImg.getBoundingClientRect();
                        offsetX = e.clientX - rect.left;
                        offsetY = e.clientY - rect.top;
                        dragImg.classList.add('lifted');
                        zCounter++;
                        dragImg.style.zIndex = zCounter;
                        isDragging = true;
                        document.addEventListener('mousemove', moveHandler);
                    } else if (dragImg === e.target) {
                        // Stop dragging - drop the image
                        dragImg.classList.remove('lifted');
                        dragImg = null;
                        isDragging = false;
                        document.removeEventListener('mousemove', moveHandler);
                    }
                }
            });
            
            function moveHandler(e) {
                if (dragImg && isDragging) {
                    dragImg.style.left = (e.clientX - offsetX) + 'px';
                    dragImg.style.top = (e.clientY - offsetY) + 'px';
                }
            }
        })();

        // Function to reset all paper states
        function resetAllPapers() {
            const items = document.querySelectorAll('.draggable-text');
            items.forEach(item => {
                item.classList.remove('lifted');
            });
            isDragging = false;
            dragImg = null;
        }

        // Function to show home page (logo + about me only)
        function showHomePage() {
            // Stop any active preview animations
            stop();
            
            // Disable drawing mode when leaving home page
            if (window.disableDrawingMode) {
                window.disableDrawingMode();
            }
            
            // Set home page state
            isHomePage = true;
            
            // Clear any project galleries
            const existingGallery = document.querySelector('.project-gallery');
            if (existingGallery) {
                existingGallery.remove();
            }
            
            // Clear all content from content-left
            const mainContent = document.querySelector('.content-left');
            mainContent.innerHTML = '<!-- Content will be dynamically loaded here -->';
            mainContent.style.display = 'none';
            
            // Hide letters gallery and clear its content
            const lettersGallery = document.getElementById('letters-gallery');
            lettersGallery.style.display = 'none';
            
            // Clear letters gallery content
            const lettersCanvas = document.getElementById('texts-canvas');
            if (lettersCanvas) {
                lettersCanvas.style.display = 'none';
            }
            
            // Hide all draggable images from Lots of Letters
            const allImages = document.querySelectorAll('.draggable-text');
            allImages.forEach(img => img.style.display = 'none');
            
            // Update text content to new home page description
            const textContent = document.querySelector('.text-content');
            textContent.innerHTML = 'Life and design explorer, pictures with meaning and quality creator.<br>I\'m interested in contributing to the visual image of modernity, while exploring and reflecting on the visual culture of our world. I\'m open to working with studios, designers, and anyone passionate about creating images that tell their own story.';
            
            // Remove active class from all nav links
            navLinks.forEach(l => l.classList.remove('active'));
            
            // Reset all papers
            resetAllPapers();
            
            // Clear commerce project
            clearCommerceProject();
            
            // Save current tab
            localStorage.setItem('activeTab', 'Home');
        }

        // Function to switch tabs
        function switchTab(tabName) {
            // Stop any active preview animations
            stop();
            
            // Disable drawing mode when switching tabs
            if (window.disableDrawingMode) {
                window.disableDrawingMode();
            }
            
            // Show navigation when switching to any tab
            const navigation = document.querySelector('.navigation');
            navigation.style.display = 'flex';
            
            // Update home page state
            isHomePage = (tabName === 'Home' || !tabName);
            
            // Remove active class from all links
            navLinks.forEach(l => l.classList.remove('active'));
            // Add active class to clicked link
            const activeLink = Array.from(navLinks).find(l => l.textContent.trim() === tabName);
            if (activeLink) activeLink.classList.add('active');
            
            // Hide all draggable images first
            const allImages = document.querySelectorAll('.draggable-text');
            allImages.forEach(img => img.style.display = 'none');
            
            // Update text content based on active tab
            updateTextContent(tabName);
            
            if (tabName === 'Lots of Letters') {
                mainContent.style.display = 'none';
                lettersGallery.style.display = 'block';
                // Show images only for Lots of Letters
                allImages.forEach(img => img.style.display = 'block');
                loadDraggableTextImages();
            } else if (tabName === 'Commerce') {
                mainContent.style.display = 'block';
                lettersGallery.style.display = 'none';
                resetAllPapers();
                // Clear any project images and back button
                clearCommerceProject();
                updateCommerceContent();
            } else if (tabName === 'About me') {
                mainContent.style.display = 'block';
                lettersGallery.style.display = 'none';
                resetAllPapers();
                clearCommerceProject();
                updateAboutMeContent();
            } else if (tabName === 'Mind') {
                mainContent.style.display = 'block';
                lettersGallery.style.display = 'none';
                resetAllPapers();
                clearCommerceProject();
                updateMindContent();
            }
            
            // Save current tab to localStorage
            localStorage.setItem('activeTab', tabName);
        }

        // Navigation handlers
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const linkText = link.textContent.trim();
                switchTab(linkText);
            });
        });

        // Preload images for better performance
        function preloadImages() {
            const criticalImages = ['0.png', '1.png', '2.png', '3.png', '4.png'];
            criticalImages.forEach(name => {
                const img = new Image();
                img.src = `https://raw.githubusercontent.com/geosapozhkov/georgii/main/texts/${name}`;
                imageCache.set(name, img.src);
            });
        }

        // Restore saved tab on page load
        document.addEventListener('DOMContentLoaded', function() {
            preloadImages(); // Start preloading critical images
            
            // Get saved tab from localStorage
            const savedTab = localStorage.getItem('activeTab');
            
            if (savedTab && savedTab !== 'Home') {
                // Restore the saved tab
                switchTab(savedTab);
            } else {
                // Show home page if no saved tab or if saved tab is Home
                showHomePage();
            }
        });

        // Dynamic project management system
        const projectData = {
            commerce: [
                { name: 'Angry Masseur', client: 'Poool', year: 2023, preview: 'angry-masseur', description: 'Angry Masseur - A comprehensive visual project showcasing character development, dual-screen experiences, and innovative storytelling techniques. This project explores the intersection of digital media and narrative design.' },
                { name: 'Type O\'clock', client: 'Contrast Foundry', year: 2022, preview: 'type-oclock', description: 'Type O\'clock - A typography-focused project exploring the intersection of time and design. This project showcases innovative approaches to type design and visual communication through the lens of temporal aesthetics.' }
            ],
            mind: [
                { name: 'Area 117', client: '', year: 2020, preview: '1', description: 'Area 117 description here...' },
                { name: 'Yoki', client: '', year: 2021, preview: '2', description: 'Yoki description here...' },
                { name: 'Red Building', client: '', year: 2022, preview: '2', description: 'Red Building description here...' },
                { name: 'Ruins', client: '', year: 2023, preview: '3', description: 'Ruins description here...' }
            ],
            about: []
        };

        // Function to add a new project with automatic sorting by year
        function addProject(section, projectName, client, year, preview = '', description = '') {
            const newProject = {
                name: projectName,
                client: client,
                year: parseInt(year),
                preview: preview,
                description: description
            };
            
            // Add project to the section
            projectData[section].push(newProject);
            
            // Sort projects by year (newest first)
            projectData[section].sort((a, b) => b.year - a.year);
            
            // Update the content if this section is currently active
            const currentTab = localStorage.getItem('activeTab');
            if (currentTab === 'Commerce' && section === 'commerce') {
                updateCommerceContent();
            } else if (currentTab === 'Mind' && section === 'mind') {
                updateMindContent();
            } else if (currentTab === 'About me' && section === 'about') {
                updateAboutMeContent();
            }
            
            console.log(`Added project "${projectName}" (${year}) to ${section}. Projects sorted by year.`);
        }

        // Function to generate catalog HTML from project data
        function generateCatalogHTML(section) {
            const projects = projectData[section];
            const maxRows = 20; // Maximum number of rows to display
            
            let html = `
                <div class="catalog-grid">
                    <div class="col-header">Project</div>
                    <div class="col-header">Client</div>
                    <div class="col-header">Year</div>
            `;
            
            // Add project rows
            for (let i = 0; i < maxRows; i++) {
                if (i < projects.length) {
                    const project = projects[i];
                    html += `
                        <div class="cell" data-preview="${project.preview}">
                            <a href="#${project.name.toLowerCase().replace(/\s+/g, '-')}" class="catalog-link" data-description="${project.description}">${project.name}</a>
                        </div>
                        <div class="cell" data-preview="${project.preview}">
                            <span class="catalog-client">${project.client || 'No Data'}</span>
                        </div>
                        <div class="cell" data-preview="${project.preview}">
                            <span class="catalog-year">${project.year}</span>
                        </div>
                    `;
                } else {
                    // Add placeholder rows
                    html += `
                        <div class="cell">
                            <span class="catalog-placeholder">No Data</span>
                        </div>
                        <div class="cell">
                            <span class="catalog-placeholder">No Data</span>
                        </div>
                        <div class="cell">
                            <span class="catalog-placeholder">No Data</span>
                        </div>
                    `;
                }
            }
            
            html += `</div>`;
            return html;
        }

        // Function to update Commerce content with same layout as Mind
        function updateCommerceContent() {
            const contentLeft = document.querySelector('.content-left');
            contentLeft.innerHTML = generateCatalogHTML('commerce');
                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>
                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>

                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>
                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>
                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>

                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>
                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>
                    <div class="cell">
                        <span class="catalog-placeholder">No Data</span>
                    </div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                </div>
            `;
            
            // Re-attach event listeners for Commerce catalog links
            attachCommerceEventListeners();
        }

        // Global function to add projects - can be called from browser console
        window.addProject = function(section, projectName, client, year, preview = '', description = '') {
            addProject(section, projectName, client, year, preview, description);
        };

        // Example usage:
        // addProject('commerce', 'New Project', 'Client Name', 2025, 'preview-id', 'Project description...');

        // Function to attach event listeners for Commerce catalog
        function attachCommerceEventListeners() {
            // Trigger preview on all cells with data-preview attribute
            document.querySelectorAll('.cell[data-preview]').forEach(cell=>{
                cell.addEventListener('mouseenter', ()=>start(cell.dataset.preview));
                cell.addEventListener('mouseleave', stop);
            });

            // Handle Commerce catalog clicks - show project gallery
            const rightText = document.querySelector('.text-content');
            const allLinks = Array.from(document.querySelectorAll('.catalog-link'));
            
            allLinks.forEach(a=>{
                a.addEventListener('click', (e)=>{
                    e.preventDefault();
                    
                    const projectName = a.textContent.trim();
                    
                    if (projectName === 'Angry Masseur') {
                        // Hide catalog and show project gallery
                        const contentLeft = document.querySelector('.content-left');
                        contentLeft.style.display = 'none';
                        
                        // Show project description
                        const desc = a.getAttribute('data-description');
                        if (desc) {
                            rightText.innerHTML = '<p>'+desc.replace(/\n/g,'</p><p>')+'</p>';
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                        
                        // Load project gallery with 12-column grid
                        loadAngryMasseurImages();
                    }
                    
                    // dim only clicked catalog name to 25% opacity; reset others to 100%
                    allLinks.forEach(l=>l.classList.remove('dimmed'));
                    a.classList.add('dimmed');
                    // mark this preview as active to disable its animated hover
                    const parentCell = a.closest('.cell');
                    if (parentCell) activePreviewId = parentCell.dataset.preview || null;
                });
            });
        }

        // Function to clear Commerce project elements
        function clearCommerceProject() {
            // Stop any active preview animations
            stop();
            
            // Remove project gallery
            const projectGallery = document.querySelector('.project-gallery');
            if (projectGallery) {
                projectGallery.remove();
            }
            
            // Remove old video containers (for backward compatibility)
            const videoContainers = document.querySelectorAll('.video-container');
            videoContainers.forEach(container => container.remove());
            
            // Show catalog again
            const contentLeft = document.querySelector('.content-left');
            contentLeft.style.display = 'block';
        }

        // Universal function to load project gallery with 12-column grid
        function loadProjectGallery(projectName, projectData) {
            // Stop any active preview animations
            stop();
            
            // Clear existing project gallery first
            const existingGallery = document.querySelector('.project-gallery');
            if (existingGallery) {
                existingGallery.remove();
            }
            
            // Create project gallery container with 12-column grid
            const gallery = document.createElement('div');
            gallery.className = 'project-gallery';
            gallery.style.position = 'fixed';
            gallery.style.top = '0';
            gallery.style.left = '0';
            gallery.style.right = '0';
            gallery.style.bottom = '0';
            gallery.style.zIndex = '100';
            gallery.style.backgroundColor = '#ffffff';
            gallery.style.overflowY = 'auto';
            
            // Project data structure: { files: [], layouts: [], basePath: '' }
            const files = projectData.files || [];
            const layouts = projectData.layouts || [];
            const basePath = projectData.basePath || '';
            
            files.forEach((filename, i) => {
                const layout = layouts[i] || { colSpan: 4, startCol: 1 };
                
                // Create media container
                const container = document.createElement('div');
                container.className = `media-container gallery-col-${layout.colSpan} gallery-start-${layout.startCol}`;
                container.style.cursor = 'pointer';
                container.style.border = 'none';
                container.style.borderRadius = '0';
                container.style.overflow = 'hidden';
                container.style.position = 'relative';
                container.style.minHeight = '300px';
                
                // Determine if it's a video or image
                const isVideo = filename.toLowerCase().endsWith('.mp4') || filename.toLowerCase().endsWith('.mov') || filename.toLowerCase().endsWith('.webm');
                
                if (isVideo) {
                    // Create video element
                    const video = document.createElement('video');
                    video.src = `${basePath}${filename}`;
                    video.className = 'project-media';
                    video.muted = true; // Muted by default
                    video.loop = true; // Loop the video
                    video.autoplay = true; // Auto-play the video
                    video.preload = 'auto'; // Preload the entire video
                    video.playsInline = true; // For mobile compatibility
                    video.style.width = '100%';
                    video.style.height = '100%';
                    video.style.objectFit = 'contain';
                    
                    // Add event listeners to ensure video plays
                    video.addEventListener('loadeddata', () => {
                        video.play().catch(e => console.log('Video autoplay prevented:', e));
                    });
                    
                    video.addEventListener('canplay', () => {
                        video.play().catch(e => console.log('Video autoplay prevented:', e));
                    });
                    
                    // Try to play immediately
                    setTimeout(() => {
                        video.play().catch(e => console.log('Video autoplay prevented:', e));
                    }, 100);
                    
                    // Create custom controls for video
                    const controls = document.createElement('div');
                    controls.className = 'media-controls';
                    controls.style.position = 'absolute';
                    controls.style.bottom = '0';
                    controls.style.left = '0';
                    controls.style.right = '0';
                    controls.style.height = '40px';
                    controls.style.backgroundColor = 'transparent';
                    controls.style.display = 'none';
                    controls.style.alignItems = 'center';
                    controls.style.padding = '0 10px';
                    controls.style.boxSizing = 'border-box';
                    
                    // Create progress bar
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar';
                    progressBar.style.flex = '1';
                    progressBar.style.height = '4px';
                    progressBar.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
                    progressBar.style.borderRadius = '2px';
                    progressBar.style.margin = '0 10px';
                    progressBar.style.position = 'relative';
                    progressBar.style.cursor = 'pointer';
                    
                    const progressFill = document.createElement('div');
                    progressFill.className = 'progress-fill';
                    progressFill.style.position = 'absolute';
                    progressFill.style.top = '0';
                    progressFill.style.left = '0';
                    progressFill.style.height = '100%';
                    progressFill.style.backgroundColor = '#ffffff';
                    progressFill.style.borderRadius = '2px';
                    progressFill.style.width = '0%';
                    
                    progressBar.appendChild(progressFill);
                    controls.appendChild(progressBar);
                    
                    container.appendChild(video);
                    container.appendChild(controls);
                    
                    // Event handlers for video
                    let isPlaying = false;
                    
                    // Show/hide controls on hover
                    container.addEventListener('mouseenter', function() {
                        controls.style.display = 'flex';
                    });
                    
                    container.addEventListener('mouseleave', function() {
                        controls.style.display = 'none';
                    });
                    
                    // Click to play/pause
                    container.addEventListener('click', function(e) {
                        e.preventDefault();
                        if (isPlaying) {
                            video.pause();
                            isPlaying = false;
                        } else {
                            video.play();
                            isPlaying = true;
                        }
                    });
                    
                    // Progress bar click to seek
                    progressBar.addEventListener('click', function(e) {
                        const rect = progressBar.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const percentage = clickX / rect.width;
                        video.currentTime = percentage * video.duration;
                    });
                    
                    // Update progress bar
                    video.addEventListener('timeupdate', function() {
                        if (video.duration) {
                            const percentage = (video.currentTime / video.duration) * 100;
                            progressFill.style.width = percentage + '%';
                        }
                    });
                    
                } else {
                    // Create image element
                    const img = document.createElement('img');
                    img.src = `${basePath}${filename}`;
                    img.className = 'project-media';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'contain';
                    img.loading = 'lazy';
                    
                    container.appendChild(img);
                    
                    // Click to open in modal
                    container.addEventListener('click', function(e) {
                        e.preventDefault();
                        const modal = document.getElementById('imageModal');
                        const modalImg = document.getElementById('modalImage');
                        modalImg.src = img.src;
                        modalImg.style.display = 'block';
                        modal.classList.add('active');
                    });
                }
                
                gallery.appendChild(container);
            });
            
            document.body.appendChild(gallery);
            console.log('Loaded', files.length, `${projectName} project media in 12-column grid layout`);
        }

        // Function to load Angry Masseur project (Commerce)
        function loadAngryMasseurImages() {
            const projectData = {
                files: [
                    'Hood_two_screens.mp4',
                    'Icons.mp4', 
                    'Igor.mp4',
                    'Zloy 011 (1080p with 30fps).mp4'
                ],
                layouts: [
                    { colSpan: 6, startCol: 1 }, // Large video - half width
                    { colSpan: 4, startCol: 7 }, // Medium video - minimum size
                    { colSpan: 4, startCol: 1 }, // Medium video - minimum size
                    { colSpan: 4, startCol: 5 } // Medium video - minimum size
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/commerce/poool/AngryM/'
            };
            
            loadProjectGallery('Angry Masseur', projectData);
        }

        // Function to load Area 117 project (Mind)
        function loadArea117Images() {
            const projectData = {
                files: [
                    'area117_1.jpg',
                    'area117_2.jpg',
                    'area117_3.jpg',
                    'area117_4.jpg'
                ],
                layouts: [
                    { colSpan: 8, startCol: 1 }, // Large image
                    { colSpan: 4, startCol: 9 }, // Medium image - minimum size
                    { colSpan: 6, startCol: 1 }, // Medium-large image
                    { colSpan: 6, startCol: 7 } // Medium-large image
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/mind/area117/'
            };
            
            loadProjectGallery('Area 117', projectData);
        }

        // Function to load Yoki project (Mind)
        function loadYokiImages() {
            const projectData = {
                files: [
                    'yoki_1.mp4',
                    'yoki_2.jpg',
                    'yoki_3.mp4'
                ],
                layouts: [
                    { colSpan: 6, startCol: 1 }, // Large video
                    { colSpan: 4, startCol: 7 }, // Medium image - minimum size
                    { colSpan: 4, startCol: 1 } // Medium video - minimum size
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/mind/yoki/'
            };
            
            loadProjectGallery('Yoki', projectData);
        }

        // Function to load Red Building project (Mind)
        function loadRedBuildingImages() {
            const projectData = {
                files: [
                    'red_building_1.jpg',
                    'red_building_2.jpg',
                    'red_building_3.jpg'
                ],
                layouts: [
                    { colSpan: 5, startCol: 1 }, // Large image
                    { colSpan: 4, startCol: 6 }, // Medium image - minimum size
                    { colSpan: 4, startCol: 10 } // Medium image - minimum size
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/mind/redbuilding/'
            };
            
            loadProjectGallery('Red Building', projectData);
        }

        // Function to load Ruins project (Mind)
        function loadRuinsImages() {
            const projectData = {
                files: [
                    'ruins_1.mp4',
                    'ruins_2.jpg',
                    'ruins_3.mp4',
                    'ruins_4.jpg'
                ],
                layouts: [
                    { colSpan: 4, startCol: 1 }, // Medium video - minimum size
                    { colSpan: 4, startCol: 5 }, // Medium image - minimum size
                    { colSpan: 4, startCol: 9 }, // Medium video - minimum size
                    { colSpan: 4, startCol: 1 } // Medium image - minimum size
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/mind/ruins/'
            };
            
            loadProjectGallery('Ruins', projectData);
        }

        // Function to update About me content with projects
        function updateAboutMeContent() {
            const contentLeft = document.querySelector('.content-left');
            if (projectData.about.length > 0) {
                contentLeft.innerHTML = generateCatalogHTML('about');
                contentLeft.style.display = 'block';
                // Re-attach event listeners for About me catalog links
                attachAboutMeEventListeners();
            } else {
                contentLeft.innerHTML = '<!-- About me content - no catalog -->';
                contentLeft.style.display = 'none';
            }
        }

        // Function to attach event listeners for About me catalog
        function attachAboutMeEventListeners() {
            // Trigger preview on all cells with data-preview attribute
            document.querySelectorAll('.cell[data-preview]').forEach(cell=>{
                cell.addEventListener('mouseenter', ()=>start(cell.dataset.preview));
                cell.addEventListener('mouseleave', stop);
            });

            // Handle About me catalog clicks - show project galleries with 12-column grid
            const rightText = document.querySelector('.text-content');
            const allLinks = Array.from(document.querySelectorAll('.catalog-link'));
            
            allLinks.forEach(a=>{
                a.addEventListener('click', (e)=>{
                    e.preventDefault();
                    
                    const projectName = a.textContent.trim();
                    
                    // Hide catalog and show project gallery
                    const contentLeft = document.querySelector('.content-left');
                    contentLeft.style.display = 'none';
                    
                    // Show project description
                    const desc = a.getAttribute('data-description');
                    if (desc) {
                        rightText.innerHTML = '<p>'+desc.replace(/\n/g,'</p><p>')+'</p>';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                    
                    // Load appropriate project gallery based on project name
                    if (projectName === 'Personal Work') {
                        loadPersonalWorkImages();
                    } else if (projectName === 'Process') {
                        loadProcessImages();
                    }
                    
                    // dim only clicked catalog name to 25% opacity; reset others to 100%
                    allLinks.forEach(l=>l.classList.remove('dimmed'));
                    a.classList.add('dimmed');
                    // mark this preview as active to disable its animated hover
                    const parentCell = a.closest('.cell');
                    if (parentCell) activePreviewId = parentCell.dataset.preview || null;
                });
            });
        }

        // Function to load Personal Work project (About me)
        function loadPersonalWorkImages() {
            const projectData = {
                files: [
                    'personal_1.mp4',
                    'personal_2.jpg',
                    'personal_3.mp4',
                    'personal_4.jpg',
                    'personal_5.mp4'
                ],
                layouts: [
                    { colSpan: 5, startCol: 1 }, // Large video
                    { colSpan: 4, startCol: 6 }, // Medium image - minimum size
                    { colSpan: 4, startCol: 10 }, // Medium video - minimum size
                    { colSpan: 6, startCol: 1 }, // Medium-large image
                    { colSpan: 6, startCol: 7 } // Medium-large video
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/about/personal/'
            };
            
            loadProjectGallery('Personal Work', projectData);
        }

        // Function to load Process project (About me)
        function loadProcessImages() {
            const projectData = {
                files: [
                    'process_1.jpg',
                    'process_2.mp4',
                    'process_3.jpg',
                    'process_4.mp4'
                ],
                layouts: [
                    { colSpan: 6, startCol: 1 }, // Large image
                    { colSpan: 6, startCol: 7 }, // Large video
                    { colSpan: 4, startCol: 1 }, // Medium image - minimum size
                    { colSpan: 8, startCol: 5 } // Large video
                ],
                basePath: 'https://raw.githubusercontent.com/geosapozhkov/georgii/main/about/process/'
            };
            
            loadProjectGallery('Process', projectData);
        }


        // Function to generate Mind catalog HTML with custom headers
        function generateMindCatalogHTML() {
            const projects = projectData.mind;
            const maxRows = 20;
            
            let html = `
                <div class="catalog-grid">
                    <div class="col-header">Than</div>
                    <div class="col-header">Now</div>
                    <div class="col-header">Then</div>
            `;
            
            // Add project rows
            for (let i = 0; i < maxRows; i++) {
                if (i < projects.length) {
                    const project = projects[i];
                    html += `
                        <div class="cell" data-preview="${project.preview}">
                            <a href="#${project.name.toLowerCase().replace(/\s+/g, '-')}" class="catalog-link" data-description="${project.description}">${project.name}</a>
                        </div>
                        <div class="cell" data-preview="${project.preview}">
                            <span class="catalog-client">${project.client || 'No Data'}</span>
                        </div>
                        <div class="cell" data-preview="${project.preview}">
                            <span class="catalog-year">${project.year}</span>
                        </div>
                    `;
                } else {
                    // Add placeholder rows
                    html += `
                        <div class="cell">
                            <span class="catalog-placeholder">No Data</span>
                        </div>
                        <div class="cell">
                            <span class="catalog-placeholder">No Data</span>
                        </div>
                        <div class="cell">
                            <span class="catalog-placeholder">No Data</span>
                        </div>
                    `;
                }
            }
            
            html += `</div>`;
            return html;
        }

        // Function to restore Mind content
        function updateMindContent() {
            const contentLeft = document.querySelector('.content-left');
            contentLeft.innerHTML = generateMindCatalogHTML();
                    <div class="cell" data-preview="2">
                        <a href="#yoki" class="catalog-link" data-description="Yoki description here...">Yoki</a>
                    </div>
                    <div class="cell" data-preview="3">
                        <span class="catalog-placeholder">No Data</span>
                    </div>

                    <div class="cell" data-preview="1"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell" data-preview="2">
                        <a href="#red-building" class="catalog-link" data-description="Red Building description here...">Red Building</a>
                    </div>
                    <div class="cell" data-preview="3">
                        <a href="#ruins" class="catalog-link" data-description="Ruins description here...">Ruins</a>
                    </div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>

                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                    <div class="cell"><span class="catalog-placeholder">No Data</span></div>
                </div>
            `;
            
            // Re-attach event listeners for Mind catalog links
            attachMindEventListeners();
        }

        // Function to attach event listeners for Mind catalog
        function attachMindEventListeners() {
            // Trigger preview only on catalog links, not empty cells
            document.querySelectorAll('.catalog-link').forEach(link=>{
                const cell = link.closest('.cell');
                if (!cell) return;
                link.addEventListener('mouseenter', ()=>start(cell.dataset.preview));
                link.addEventListener('mouseleave', stop);
            });

            // Handle Mind catalog clicks - show project galleries with 12-column grid
            const rightText = document.querySelector('.text-content');
            const allLinks = Array.from(document.querySelectorAll('.catalog-link'));
            allLinks.forEach(a=>{
                a.addEventListener('click', (e)=>{
                    e.preventDefault();
                    
                    const projectName = a.textContent.trim();
                    
                    // Hide catalog and show project gallery
                    const contentLeft = document.querySelector('.content-left');
                    contentLeft.style.display = 'none';
                    
                    // Show project description
                    const desc = a.getAttribute('data-description');
                    if (desc) {
                        rightText.innerHTML = '<p>'+desc.replace(/\n/g,'</p><p>')+'</p>';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                    
                    // Load appropriate project gallery based on project name
                    if (projectName === 'Area 117') {
                        loadArea117Images();
                    } else if (projectName === 'Yoki') {
                        loadYokiImages();
                    } else if (projectName === 'Red Building') {
                        loadRedBuildingImages();
                    } else if (projectName === 'Ruins') {
                        loadRuinsImages();
                    }
                    
                    // dim only clicked catalog name to 25% opacity; reset others to 100%
                    allLinks.forEach(l=>l.classList.remove('dimmed'));
                    a.classList.add('dimmed');
                    // mark this preview as active to disable its animated hover
                    const parentCell = a.closest('.cell');
                    if (parentCell) activePreviewId = parentCell.dataset.preview || null;
                });
            });
        }

        // Function to update text content based on active tab
        function updateTextContent(tabName) {
            const textContent = document.querySelector('.text-content');
            
            switch(tabName) {
                case 'Lots of Letters':
                    textContent.innerHTML = '';
                    break;
                case 'Commerce':
                    textContent.innerHTML = 'Here you can see my commercial projects and collaborations with various clients. Each project represents a unique challenge and creative solution tailored to specific brand needs and market requirements. I work closely with clients to understand their vision and translate it into compelling visual narratives that resonate with their target audience.';
                    break;
                case 'About me':
                    textContent.innerHTML = 'Life and design explorer, pictures with meaning and quality creator.<br>I\'m interested in contributing to the visual image of modernity, while exploring and reflecting on the visual culture of our world. I\'m open to working with studios, designers, and anyone passionate about creating images that tell their own story.';
                    break;
                case 'Mind':
                    textContent.innerHTML = 'A conceptual exploration of the tension between rational and irrational forces through visual narratives. This ongoing project examines themes of control, freedom, and human nature through the lens of architectural and environmental storytelling. Each piece represents a moment of reflection on our relationship with systems, structures, and the boundaries that define our existence.';
                    break;
                default:
                    // Home page content (same as About me)
                    textContent.innerHTML = 'Life and design explorer, pictures with meaning and quality creator.<br>I\'m interested in contributing to the visual image of modernity, while exploring and reflecting on the visual culture of our world. I\'m open to working with studios, designers, and anyone passionate about creating images that tell their own story.';
                    break;
            }
        }

        // Modal handlers
        imageModal.addEventListener('click', () => {
            imageModal.classList.remove('active');
            // Stop video when modal closes
            const modalVideo = document.getElementById('modalVideo');
            if (modalVideo) {
                modalVideo.pause();
                modalVideo.currentTime = 0;
            }
        });

        // Video optimization and mute toggle
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('video').forEach(video => {
                // Optimize video loading
                video.preload = 'metadata'; // Only load metadata initially
                video.muted = true; // Muted by default for better UX
                
                video.addEventListener('click', function() {
                    video.muted = !video.muted;
                });
                
                // Load video only when it comes into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            video.preload = 'auto';
                            observer.unobserve(video);
                        }
                    });
                });
                observer.observe(video);
            });
        });

        // Function to create preview rectangles for logo hover (home page only)
        async function createLogoPreviewRects() {
            if (rects.length > 0) return;
            
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            const rnd = (min, max) => Math.random() * (max - min) + min;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // RND images from GitHub - dynamically loaded
            let rndImages = [];
            
            // Function to load images list from GitHub
            async function loadRndImages() {
                try {
                    const response = await fetch('https://api.github.com/repos/geosapozhkov/georgii/contents/RND');
                    const files = await response.json();
                    rndImages = files
                        .filter(file => file.name.toLowerCase().endsWith('.png') || file.name.toLowerCase().endsWith('.jpg'))
                        .map(file => file.name);
                    
                    console.log('Loaded RND images:', rndImages);
                } catch (error) {
                    console.log('Failed to load RND images, using fallback:', error);
                    // Fallback to hardcoded list
                    rndImages = [
                        'image 1.png',
                        'image 5.png',
                        'image 2090008760.png',
                        'image 2090008770.png',
                        'Crash0016.png'
                    ];
                }
            }
            
            // Load images first
            await loadRndImages();
            
            // Create single moving image with dynamic sizing
            const maxWidth = Math.floor(window.innerWidth * 0.9); // 90% of screen width
            const maxHeight = Math.floor(window.innerHeight * 0.8); // 80% of screen height
            
            // Create single rectangle for the moving image
            const rect = {
                x: window.innerWidth / 2, // Start from center
                y: window.innerHeight / 2, // Start from center
                w: maxWidth, // Will be adjusted based on image aspect ratio
                h: maxHeight, // Will be adjusted based on image aspect ratio
                vx: rnd(-0.4, 0.4) || 0.2, // Smoother movement
                vy: rnd(-0.4, 0.4) || -0.2, // Smoother movement
                currentImageIndex: Math.floor(Math.random() * rndImages.length),
                imageChangeTimer: 0,
                imageElement: null,
                maxWidth: maxWidth,
                maxHeight: maxHeight
            };
            
            rects = [rect];
            
            // Create and load the first image
            function loadCurrentImage() {
                // Create new image element first
                const img = document.createElement('img');
                img.src = `https://raw.githubusercontent.com/geosapozhkov/georgii/main/RND/${rndImages[rect.currentImageIndex]}`;
                
                // Wait for image to load to get its natural dimensions
                img.onload = function() {
                    const naturalWidth = img.naturalWidth;
                    const naturalHeight = img.naturalHeight;
                    const aspectRatio = naturalWidth / naturalHeight;
                    
                    // Calculate optimal size maintaining aspect ratio
                    let newWidth, newHeight;
                    
                    if (aspectRatio > rect.maxWidth / rect.maxHeight) {
                        // Image is wider - fit to max width
                        newWidth = rect.maxWidth;
                        newHeight = rect.maxWidth / aspectRatio;
                    } else {
                        // Image is taller - fit to max height
                        newHeight = rect.maxHeight;
                        newWidth = rect.maxHeight * aspectRatio;
                    }
                    
                    // Update rect dimensions
                    rect.w = Math.floor(newWidth);
                    rect.h = Math.floor(newHeight);
                    
                    // Center the image if it's the first load
                    if (!rect.imageElement) {
                        rect.x = (window.innerWidth - rect.w) / 2;
                        rect.y = (window.innerHeight - rect.h) / 2;
                    }
                    
                    // Ensure image fits within screen bounds
                    if (rect.x + rect.w > window.innerWidth) {
                        rect.x = window.innerWidth - rect.w;
                    }
                    if (rect.y + rect.h > window.innerHeight) {
                        rect.y = window.innerHeight - rect.h;
                    }
                    
                    // Apply styles
                    img.style.position = 'fixed';
                    img.style.left = rect.x + 'px';
                    img.style.top = rect.y + 'px';
                    img.style.width = rect.w + 'px';
                    img.style.height = rect.h + 'px';
                    img.style.objectFit = 'contain'; // Use contain to preserve aspect ratio
                    img.style.zIndex = '1007';
                    img.style.pointerEvents = 'none';
                    img.style.transition = 'none'; // Disable transitions to prevent flicker
                    
                    // Remove old image only after new one is ready
                    if (rect.imageElement) {
                        rect.imageElement.remove();
                    }
                    
                    document.body.appendChild(img);
                    rect.imageElement = img;
                };
                
                // If image fails to load, use fallback dimensions
                img.onerror = function() {
                    rect.w = rect.maxWidth;
                    rect.h = rect.maxHeight;
                    
                    // Center the image if it's the first load
                    if (!rect.imageElement) {
                        rect.x = (window.innerWidth - rect.w) / 2;
                        rect.y = (window.innerHeight - rect.h) / 2;
                    }
                    
                    img.style.position = 'fixed';
                    img.style.left = rect.x + 'px';
                    img.style.top = rect.y + 'px';
                    img.style.width = rect.w + 'px';
                    img.style.height = rect.h + 'px';
                    img.style.objectFit = 'contain';
                    img.style.zIndex = '1007';
                    img.style.pointerEvents = 'none';
                    img.style.transition = 'none';
                    
                    // Remove old image only after new one is ready
                    if (rect.imageElement) {
                        rect.imageElement.remove();
                    }
                    
                    document.body.appendChild(img);
                    rect.imageElement = img;
                };
            }
            
            loadCurrentImage();
            
            // Start animation with image changing
            function animateWithImageChange() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Update position
                rect.x += rect.vx;
                rect.y += rect.vy;
                
                // Bounce off edges using actual image dimensions
                if (rect.x <= 0 || rect.x + rect.w >= window.innerWidth) {
                    rect.vx *= -1;
                    rect.x = Math.max(0, Math.min(window.innerWidth - rect.w, rect.x));
                }
                if (rect.y <= 0 || rect.y + rect.h >= window.innerHeight) {
                    rect.vy *= -1;
                    rect.y = Math.max(0, Math.min(window.innerHeight - rect.h, rect.y));
                }
                
                // Update image element position and size
                if (rect.imageElement) {
                    rect.imageElement.style.left = rect.x + 'px';
                    rect.imageElement.style.top = rect.y + 'px';
                    rect.imageElement.style.width = rect.w + 'px';
                    rect.imageElement.style.height = rect.h + 'px';
                }
                
                // Change image every second (60 frames at 60fps)
                rect.imageChangeTimer++;
                if (rect.imageChangeTimer >= 60) {
                    rect.currentImageIndex = Math.floor(Math.random() * rndImages.length);
                    loadCurrentImage();
                    rect.imageChangeTimer = 0;
                }
                
                animationId = requestAnimationFrame(animateWithImageChange);
            }
            
            animateWithImageChange();
        }

        // Logo handler
        const logo = document.getElementById('logo');
        logo.addEventListener('click', (e) => {
            e.preventDefault();
            showHomePage();
        });

        // Logo hover handlers (only on home page)
        let isHomePage = true;
        logo.addEventListener('mouseenter', async () => {
            if (isHomePage) {
                await createLogoPreviewRects();
            }
        });
        
        logo.addEventListener('mouseleave', () => {
            if (isHomePage) {
                stop();
            }
        });

            // Custom cursor tracking
            document.addEventListener('mousemove', (e) => {
                const cursor = document.getElementById('customCursor');
                const drawingCursor = document.getElementById('drawingCursor');
                
                if (cursor && !window.isDrawingMode) {
                    cursor.style.left = e.clientX + 'px';
                    cursor.style.top = e.clientY + 'px';
                }
                
                if (drawingCursor && window.isDrawingMode) {
                    drawingCursor.style.left = e.clientX + 'px';
                    drawingCursor.style.top = e.clientY + 'px';
                }
            });

        // Navigation handlers
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const linkText = link.textContent.trim();
                switchTab(linkText);
            });
        });

        // Drawing functionality
        (function() {
            const drawingCanvas = document.getElementById('drawingCanvas');
            const drawingCtx = drawingCanvas.getContext('2d');
            const drawingCursor = document.getElementById('drawingCursor');
            const customCursor = document.getElementById('customCursor');
            
            let isDrawing = false;
            let isErasing = false;
            let brushSize = 3;
            let isDrawingMode = false;
            
            // Initialize drawing canvas
            function initDrawingCanvas() {
                drawingCanvas.width = window.innerWidth;
                drawingCanvas.height = window.innerHeight;
                drawingCanvas.style.pointerEvents = 'auto';
                drawingCanvas.style.display = 'none';
                drawingCtx.lineCap = 'round';
                drawingCtx.lineJoin = 'round';
                drawingCtx.strokeStyle = '#000000';
            }
            
            // Update cursor size
            function updateCursorSize() {
                drawingCursor.style.width = brushSize + 'px';
                drawingCursor.style.height = brushSize + 'px';
            }
            
            // Enable drawing mode
            function enableDrawingMode() {
                if (!isHomePage) return;
                
                isDrawingMode = true;
                drawingCanvas.style.display = 'block';
                drawingCursor.style.display = 'block';
                customCursor.style.display = 'none';
                updateCursorSize();
            }
            
            // Disable drawing mode
            function disableDrawingMode() {
                isDrawingMode = false;
                drawingCanvas.style.display = 'none';
                drawingCursor.style.display = 'none';
                customCursor.style.display = 'block';
            }
            
            // Mouse events
            drawingCanvas.addEventListener('mousedown', (e) => {
                if (!isDrawingMode) return;
                
                isDrawing = true;
                isErasing = (e.button === 2); // Right mouse button
                
                drawingCursor.classList.toggle('eraser', isErasing);
                
                drawingCtx.beginPath();
                drawingCtx.moveTo(e.clientX, e.clientY);
                
                if (isErasing) {
                    drawingCtx.globalCompositeOperation = 'destination-out';
                } else {
                    drawingCtx.globalCompositeOperation = 'source-over';
                    drawingCtx.strokeStyle = '#000000';
                }
                
                drawingCtx.lineWidth = brushSize;
                drawingCtx.lineTo(e.clientX, e.clientY);
                drawingCtx.stroke();
                
                e.preventDefault();
            });
            
            drawingCanvas.addEventListener('mousemove', (e) => {
                if (!isDrawingMode) return;
                
                // Update cursor position
                drawingCursor.style.left = e.clientX + 'px';
                drawingCursor.style.top = e.clientY + 'px';
                
                if (isDrawing) {
                    drawingCtx.lineTo(e.clientX, e.clientY);
                    drawingCtx.stroke();
                }
                
                e.preventDefault();
            });
            
            drawingCanvas.addEventListener('mouseup', () => {
                isDrawing = false;
                isErasing = false;
                drawingCursor.classList.remove('eraser');
            });
            
            drawingCanvas.addEventListener('mouseleave', () => {
                isDrawing = false;
                isErasing = false;
                drawingCursor.classList.remove('eraser');
            });
            
            // Prevent context menu on right click
            drawingCanvas.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
            
            // Keyboard events
            document.addEventListener('keydown', (e) => {
                if (!isDrawingMode) return;
                
                if (e.key === '+' || e.key === '=') {
                    brushSize = Math.min(brushSize + 1, 100);
                    updateCursorSize();
                    e.preventDefault();
                } else if (e.key === '-') {
                    brushSize = Math.max(brushSize - 1, 1);
                    updateCursorSize();
                    e.preventDefault();
                }
            });
            
            // Mouse wheel events
            document.addEventListener('wheel', (e) => {
                if (!isDrawingMode) return;
                
                if (e.deltaY < 0) {
                    // Scroll up - increase brush size
                    brushSize = Math.min(brushSize + 1, 100);
                } else {
                    // Scroll down - decrease brush size
                    brushSize = Math.max(brushSize - 1, 1);
                }
                updateCursorSize();
                e.preventDefault();
            });
            
            // Toggle drawing mode with spacebar
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && isHomePage) {
                    e.preventDefault();
                    if (isDrawingMode) {
                        disableDrawingMode();
                    } else {
                        enableDrawingMode();
                    }
                }
            });
            
            // Initialize on page load
            initDrawingCanvas();
            
            // Resize canvas on window resize
            window.addEventListener('resize', () => {
                initDrawingCanvas();
            });
            
            // Expose functions and variables globally for tab switching
            window.enableDrawingMode = enableDrawingMode;
            window.disableDrawingMode = disableDrawingMode;
            window.isDrawingMode = false;
            
            // Update global variable when drawing mode changes
            const originalEnableDrawingMode = enableDrawingMode;
            const originalDisableDrawingMode = disableDrawingMode;
            
            window.enableDrawingMode = function() {
                originalEnableDrawingMode();
                window.isDrawingMode = true;
            };
            
            window.disableDrawingMode = function() {
                originalDisableDrawingMode();
                window.isDrawingMode = false;
            };
        })();
    })();

    // Debug grid toggle (Ctrl+G)
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'g') {
            e.preventDefault();
            document.body.classList.toggle('debug');
        }
    });

</script>
</html>
